---
import inovera from "../../assets/inovera.png";
import mediamag from "../../assets/mediamag.png";

import adonisLogo from "../../assets/technos/adonis.svg";
import cplusplusLogo from "../../assets/technos/cplusplus.svg";
import mysqlLogo from "../../assets/technos/mysql.svg";
import phpLogo from "../../assets/technos/php.svg";
import pythonLogo from "../../assets/technos/python.svg";
import reactLogo from "../../assets/technos/react.svg";
import symfonyLogo from "../../assets/technos/symfony.svg";
import typescriptLogo from "../../assets/technos/typescript.svg";
import TechTag from "../TechTag.astro";

const workExperiences = [
  {
    company: {
      name: "Médiamag",
      logo: mediamag,
      website: "https://www.mediamag-systeme.com/",
    },
    position: "Développeur Full Stack",
    dateRange: "Avril 2023 - Août 2024",
    tasks: [
      "Développement de plusieurs applications internes afin d'améliorer l'autonomie des employés.",
      "Développement d'une application permettant de s'ouvrir à de nouveaux clients sur le marché avec une nouvelle offre, permettant aux utilisateurs de s'enregistrer sans avoir à passer par les voix professionnelles de Médiamag.",
      "Création de modules externes pour l'application principale de la société en C++, Python.",
    ],
    technologies: [
      { name: "AdonisJS", logo: adonisLogo, url: "https://adonisjs.com/" },
      { name: "C++", logo: cplusplusLogo, url: "https://cplusplus.com/" },
      { name: "MySQL", logo: mysqlLogo, url: "https://www.mysql.com/" },
      { name: "Python", logo: pythonLogo, url: "https://www.python.org/" },
      { name: "React", logo: reactLogo, url: "https://react.dev/" },
      {
        name: "TypeScript",
        logo: typescriptLogo,
        url: "https://www.typescriptlang.org/",
      },
    ],
  },
  {
    company: {
      name: "Inovera",
      logo: inovera,
      website: "https://www.inovera.fr/",
    },
    position: "Développeur Full Stack",
    dateRange: "Novembre 2024",
    isCurrentJob: true,
    tasks: [
      "Migration d'une application Symfony vers une nouvelle solution front-end en React avec transformation du backend Symfony en API REST/JSON.",
      "Application du nouveau design sur les applications de la société.",
      "Gestion et coordination des projets via Jira avec planification des tickets et méthodologie Kanban.",
      "Maintenance et développement de nouvelles fonctionnalités sur les applications existantes de la société.",
    ],
    technologies: [
      { name: "MySQL", logo: mysqlLogo, url: "https://www.mysql.com/" },
      { name: "PHP", logo: phpLogo, url: "https://www.php.net/" },
      { name: "React", logo: reactLogo, url: "https://react.dev/" },
      { name: "Symfony", logo: symfonyLogo, url: "https://symfony.com/" },
      {
        name: "TypeScript",
        logo: typescriptLogo,
        url: "https://www.typescriptlang.org/",
      },
    ],
  },
];
---

<section id="work">
  <div class="work__wrapper">
    <h2 class="work__title" data-reveal="up">
      <span>C'est un réel plaisir <br /> de travailler ensemble</span>
    </h2>
    <div class="work__content" data-reveal="up" data-reveal-delay="1">
      {
        workExperiences.map((experience, index) => (
          <article
            class="work__content__item"
            style={index !== 0 ? "display: none;" : ""}
            data-work-item={index}
          >
            <header class="work__content__item__header">
              <img
                src={experience.company.logo.src}
                alt={experience.company.name}
              />
            </header>
            <div class="work__content__item__body">
              <h3 class="work__content__item__body__title">
                {experience.position}
              </h3>
              <span class="work__content__item__body__date">
                {experience.isCurrentJob ? (
                  <>
                    {experience.dateRange} -{" "}
                    <span class="work__content__item__body__date-highlight">
                      Maintenant
                    </span>
                  </>
                ) : (
                  experience.dateRange
                )}
              </span>
              <ul>
                {experience.tasks.map((task) => (
                  <li>{task}</li>
                ))}
              </ul>
            </div>
            <footer class="work__content__item__footer">
              <h3>Technologies</h3>
              <div class="work__content__item__footer__tags">
                {experience.technologies.map((tech) => (
                  <TechTag
                    name={tech.name}
                    logo={tech.logo}
                    url={tech.url}
                    className="work__content__item__footer__tags-tag"
                  />
                ))}
              </div>
              <a
                href={experience.company.website}
                target="_blank"
                rel="noopener noreferrer"
                class="work__content__item__footer-button"
                draggable="false"
              >
                Site de l'entreprise
              </a>
            </footer>
          </article>
        ))
      }
      <ul id="company-list" class="work__company-list">
        {
          workExperiences.map((experience, index) => (
            <li
              class={`work__company-list__item ${index === 0 ? "active" : ""}`}
              data-index={index}
            >
              <img
                src={experience.company.logo.src}
                alt={experience.company.name}
              />
              <div class="company-details">
                <span class="company-name">{experience.company.name}</span>
                <span class="company-date">
                  {experience.dateRange}
                  {experience.isCurrentJob && (
                    <>
                      {" "}
                      - <span class="current-job-tag">Maintenant</span>
                    </>
                  )}
                </span>
              </div>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</section>

<style is:global>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .work__content__item.is-animating-in {
    animation: fadeIn 0.4s ease-out;
  }
</style>

<script>
  const companyListItems = document.querySelectorAll(
    ".work__company-list__item"
  );
  const workItems = document.querySelectorAll("[data-work-item]");

  companyListItems.forEach((item) => {
    item.addEventListener("click", () => {
      companyListItems.forEach((i) => i.classList.remove("active"));
      item.classList.add("active");

      const selectedIndex = parseInt(
        (item as HTMLElement).dataset.index || "0",
        10
      );

      workItems.forEach((workItem) => {
        const workItemIndex = parseInt(
          (workItem as HTMLElement).dataset.workItem || "0",
          10
        );

        workItem.classList.remove("is-animating-in");

        if (workItemIndex === selectedIndex) {
          (workItem as HTMLElement).style.display = "";
          workItem.classList.add("is-animating-in");
        } else {
          (workItem as HTMLElement).style.display = "none";
        }
      });
    });
  });
</script>
